{% extends "events/structure.html" %}
{% load static %}
{% block title %}Events{% endblock title %}

{% block content %}
{% if counts.total == 0%}
  {% comment %} Empty List {% endcomment %}
  {% include 'empty_list.html' with message="No Event has been added yet!"%}
{% else %}
{% comment %} level-2 serach_bar {% endcomment %}
 <section class="my-10 flex items-center justify-center h-[30vh] bg-gray-50">
  <div class="w-full px-4 md:w-1/2">
    <form method="GET" action="{% url 'search' %}" class="flex flex-col md:flex-row items-center md:items-stretch">
      <input 
        type="text" 
        name="search"
        placeholder="Search for events..." 
        class="flex md:flex-1 px-6 py-3 border border-gray-300 rounded-lg md:rounded-r-none shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-lg"
        value="{{ request.GET.search }}"
      />
      <button 
        type="submit"
        class="px-3 md:px-6 py-2 md:py-3 my-3 md:my-0 bg-indigo-600 text-white rounded-lg md:rounded-l-none md:w-auto hover:bg-indigo-700 transition font-medium"
      >
        Search
      </button>
    </form>
  </div>
</section>
{% comment %} level-3 Catagory-Dropbar {% endcomment %}
<!-- Categories Section -->
<section class="h-[33vh] bg-white flex flex-col items-center justify-center">
  <!-- Heading -->
  <div class="mb-3">
    <h2 class="text-xl font-semibold text-gray-800">Categories (Total - {{counts.total}})</h2>
  </div>

  <!-- Dropdown -->
  <div>
  <select class="w-52 px-4 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 text-gray-700" 
          onchange="window.location.href='{% url 'home' %}?type=' + this.value">
    <option value="all" {% if selected_type == 'all' %}selected{% endif %}>All</option>
    {% for category in categories_with_events %}
    <option value="{{category.name}}" {% if selected_type == category.name %}selected{% endif %}>
      {{category.name}}
    </option>
    {% endfor %}
  </select>
</div>
</section>

{% comment %} level-4 Lists {% endcomment %}
<!-- Events Section -->
<section class="bg-gray-100 px-4 md:px-32 py-8">

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
  {% for event in event_list %}
      <!-- Event Row 1 -->
       <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl p-2">
        <div class=" bg-white text-white shadow-md rounded-lg p-4">
      <div class="mb-2 text-center">
        <h3 class="flex justify-center text-5xl border-b-2	pb-5 font-semibold text-black">{{event.name}}</h3>
      </div>
      <div class="flex justify-center mb-4 text-black">
        <p class="text-lg text-gray-800"><span class="font-semibold">Description :</span> {{event.description}}</p>
      </div>
      <div class="flex justify-center  mb-4 text-black">
                      <p class="text-lg font-semibold text-gray-800">Date :</p>
                      <p class="text-lg font-semibold text-gray-800">
                        {{event.date|date:"F j, Y"}}
                      </p>
                    </div>
      <div class="flex justify-center gap-10">
        <a href="{% url 'event_details' event.id %}" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition text-center">Details</a>

        {% if current_user.groups.first.name == "Participant" %}
          {% if current_user in event.participants.all %}
            <span class="px-4 py-2 bg-gray-400 text-white rounded">Already selected</span>
          {% else %}
            <form method="post" action="{% url 'rsvp-event' event.id %}">
              {% csrf_token %}
              <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition">
                Interested
              </button>
            </form>
          {% endif %}
        {% else %}
          <a href='{% url "update_event" event.id %}' class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition">
            Edit
          </a>
        {% endif %}

      </div>
    </div>
       </div>
    
    {% endfor %}
</div>


</section>
{% endif %}
{% endblock content %}
